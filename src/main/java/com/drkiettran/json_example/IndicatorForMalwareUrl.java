package com.drkiettran.json_example;

import java.io.IOException;
import java.net.URISyntaxException;
import java.net.URL;
import java.nio.charset.Charset;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.List;

import com.drkiettran.json_example.stix2.types.Bundle;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;

public class IndicatorForMalwareUrl {

	private Bundle stixBundle;

	public IndicatorForMalwareUrl(String stixFileName) throws URISyntaxException, IOException {
		ClassLoader classLoader = getClass().getClassLoader();
		URL resource = classLoader.getResource(stixFileName);
		Path stixPath = Paths.get(resource.toURI());
		Charset charset = Charset.forName("ISO-8859-1");
		List<String> lines = Files.readAllLines(stixPath, charset);
		StringBuilder sb = new StringBuilder();
		for (String line : lines) {
			sb.append(line).append('\n');
		}

		ObjectMapper om = new ObjectMapper();
		stixBundle = om.readValue(sb.toString(), Bundle.class);
		System.out.println("Success!");
	}

	public IndicatorForMalwareUrl(Bundle stixBundle) {
		this.stixBundle = stixBundle;
	}

	public String toString() {
		ObjectMapper om = new ObjectMapper();
		try {
			return om.writeValueAsString(stixBundle);
		} catch (JsonProcessingException e) {
			e.printStackTrace();
		}
		return "*** ERROR ***";
	}

}
